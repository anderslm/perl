From bcfa2dafdaa0c3d71d88540300677f2af33ba06d Mon Sep 17 00:00:00 2001
From: Wulf C. Krueger <philantrop@exherbo.org>
Date: Sun, 20 Sep 2009 19:07:49 +0200
Subject: [PATCH] Add DESTDIR to the install targets to avoid build problems in sandbox environments.

Upstream: Yes, https://issues.apache.org/SpamAssassin/show_bug.cgi?id=5944
---
 Makefile.PL |   22 +++++++++++-----------
 1 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/Makefile.PL b/Makefile.PL
index e47a76d..7bc62af 100644
--- a/Makefile.PL
+++ b/Makefile.PL
@@ -1200,24 +1200,24 @@ qmail/qmail-spamc$(EXE_EXT): spamc/qmail-spamc$(EXE_EXT)
 #        # $(SYMLINK) $(INST_SCRIPT)/sa-filter $(B_SCRIPTDIR)/spamassassin
 
 conf__install:
-	-$(MKPATH) $(B_CONFDIR)
-	$(PERL) -MFile::Copy -e "copy(q{rules/local.cf}, q{$(B_CONFDIR)/local.cf}) unless -f q{$(B_CONFDIR)/local.cf}"
-	$(PERL) -MFile::Copy -e "copy(q{rules/init.pre}, q{$(B_CONFDIR)/init.pre}) unless -f q{$(B_CONFDIR)/init.pre}"
-	$(PERL) -MFile::Copy -e "copy(q{rules/v310.pre}, q{$(B_CONFDIR)/v310.pre}) unless -f q{$(B_CONFDIR)/v310.pre}"
-	$(PERL) -MFile::Copy -e "copy(q{rules/v312.pre}, q{$(B_CONFDIR)/v312.pre}) unless -f q{$(B_CONFDIR)/v312.pre}"
-	$(PERL) -MFile::Copy -e "copy(q{rules/v320.pre}, q{$(B_CONFDIR)/v320.pre}) unless -f q{$(B_CONFDIR)/v320.pre}"
+	-$(MKPATH) $(DESTDIR)$(B_CONFDIR)
+	$(PERL) -MFile::Copy -e "copy(q{rules/local.cf}, q{$(DESTDIR)$(B_CONFDIR)/local.cf}) unless -f q{$(DESTDIR)$(B_CONFDIR)/local.cf}"
+	$(PERL) -MFile::Copy -e "copy(q{rules/init.pre}, q{$(DESTDIR)$(B_CONFDIR)/init.pre}) unless -f q{$(DESTDIR)$(B_CONFDIR)/init.pre}"
+	$(PERL) -MFile::Copy -e "copy(q{rules/v310.pre}, q{$(DESTDIR)$(B_CONFDIR)/v310.pre}) unless -f q{$(DESTDIR)$(B_CONFDIR)/v310.pre}"
+	$(PERL) -MFile::Copy -e "copy(q{rules/v312.pre}, q{$(DESTDIR)$(B_CONFDIR)/v312.pre}) unless -f q{$(DESTDIR)$(B_CONFDIR)/v312.pre}"
+	$(PERL) -MFile::Copy -e "copy(q{rules/v320.pre}, q{$(DESTDIR)$(B_CONFDIR)/v320.pre}) unless -f q{$(DESTDIR)$(B_CONFDIR)/v320.pre}"
 
 data__install:
-	-$(MKPATH) $(B_DATADIR)
-	$(PERL) -e "map unlink, <$(B_DATADIR)/*>"
-	$(PREPROCESS) $(FIXVARS) -m$(PERM_RW) -Irules -O$(B_DATADIR) $(DATAFILES)
-	$(CHMOD) $(PERM_RWX) $(B_DATADIR)
+	-$(MKPATH) $(DESTDIR)$(B_DATADIR)
+	$(PERL) -e "map unlink, <$(DESTDIR)$(B_DATADIR)/*>"
+	$(PREPROCESS) $(FIXVARS) -m$(PERM_RW) -Irules -O$(DESTDIR)$(B_DATADIR) $(DATAFILES)
+	$(CHMOD) $(PERM_RWX) $(DESTDIR)$(B_DATADIR)
 
 text_html_doc: made-doc-stamp
 	$(NOOP)
 
 doc:
-	$(MKPATH) $@
+	$(MKPATH) $(DESTDIR)$@
 
 made-doc-stamp: doc $(MAN1PODS) $(MAN3PODS) $(EXTRAPODS)
 	$(PERL) build/convert_pods_to_doc $(MAN1PODS) $(MAN3PODS) $(EXTRAPODS)
-- 
1.6.4.1

